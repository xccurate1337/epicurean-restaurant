{% extends 'base.html' %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - –†–µ—Å—Ç–æ—Ä–∞–Ω "–≠–ø–∏–∫—É—Ä–µ–π"{% endblock %}

{% block content %}
<h1 class="page-title">–ò—Å–∫—É—Å—Å—Ç–≤–æ –≤–∫—É—Å–∞ üçΩÔ∏è</h1>

<!-- –§–∏–ª—å—Ç—Ä—ã -->
<div class="filters">
    <form method="GET" action="{% url 'home' %}" class="filter-group">
        <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ –±–ª—é–¥..." value="{{ query }}" class="search-input">

        <select name="–∫–∞—Ç–µ–≥–æ—Ä–∏—è" class="filter-select">
            <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
            {% for –∫–∞—Ç–µ–≥–æ—Ä–∏—è in –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ %}
            <option value="{{ –∫–∞—Ç–µ–≥–æ—Ä–∏—è.slug }}" {% if selected_filters.–∫–∞—Ç–µ–≥–æ—Ä–∏—è == –∫–∞—Ç–µ–≥–æ—Ä–∏—è.slug %}selected{% endif %}>
                {{ –∫–∞—Ç–µ–≥–æ—Ä–∏—è.–∏–∫–æ–Ω–∫–∞ }} {{ –∫–∞—Ç–µ–≥–æ—Ä–∏—è.–Ω–∞–∑–≤–∞–Ω–∏–µ }}
            </option>
            {% endfor %}
        </select>

        <select name="—Ç–∏–ø" class="filter-select">
            <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
            <option value="–∑–∞–∫—É—Å–∫–∞" {% if selected_filters.—Ç–∏–ø == '–∑–∞–∫—É—Å–∫–∞' %}selected{% endif %}>ü•ó –ó–∞–∫—É—Å–∫–∏</option>
            <option value="—Å–∞–ª–∞—Ç" {% if selected_filters.—Ç–∏–ø == '—Å–∞–ª–∞—Ç' %}selected{% endif %}>ü•¨ –°–∞–ª–∞—Ç—ã</option>
            <option value="—Å—É–ø" {% if selected_filters.—Ç–∏–ø == '—Å—É–ø' %}selected{% endif %}>üçú –°—É–ø—ã</option>
            <option value="–æ—Å–Ω–æ–≤–Ω–æ–µ" {% if selected_filters.—Ç–∏–ø == '–æ—Å–Ω–æ–≤–Ω–æ–µ' %}selected{% endif %}>üçñ –û—Å–Ω–æ–≤–Ω—ã–µ</option>
            <option value="–¥–µ—Å–µ—Ä—Ç" {% if selected_filters.—Ç–∏–ø == '–¥–µ—Å–µ—Ä—Ç' %}selected{% endif %}>üç∞ –î–µ—Å–µ—Ä—Ç—ã</option>
            <option value="–Ω–∞–ø–∏—Ç–æ–∫" {% if selected_filters.—Ç–∏–ø == '–Ω–∞–ø–∏—Ç–æ–∫' %}selected{% endif %}>ü•§ –ù–∞–ø–∏—Ç–∫–∏</option>
        </select>

        <input type="number" name="–º–∏–Ω_—Ü–µ–Ω–∞" placeholder="–ú–∏–Ω —Ü–µ–Ω–∞" value="{{ selected_filters.–º–∏–Ω_—Ü–µ–Ω–∞ }}" class="filter-select">
        <input type="number" name="–º–∞–∫—Å_—Ü–µ–Ω–∞" placeholder="–ú–∞–∫—Å —Ü–µ–Ω–∞" value="{{ selected_filters.–º–∞–∫—Å_—Ü–µ–Ω–∞ }}" class="filter-select">

        <select name="—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞" class="filter-select">
            <option value="–ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å" {% if selected_filters.—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ == '–ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å' %}selected{% endif %}>–ü–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏</option>
            <option value="—Ü–µ–Ω–∞_–≤–æ–∑—Ä" {% if selected_filters.—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ == '—Ü–µ–Ω–∞_–≤–æ–∑—Ä' %}selected{% endif %}>–¶–µ–Ω–∞ ‚Üë</option>
            <option value="—Ü–µ–Ω–∞_—É–±—ã–≤" {% if selected_filters.—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ == '—Ü–µ–Ω–∞_—É–±—ã–≤' %}selected{% endif %}>–¶–µ–Ω–∞ ‚Üì</option>
            <option value="—Ä–µ–π—Ç–∏–Ω–≥" {% if selected_filters.—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ == '—Ä–µ–π—Ç–∏–Ω–≥' %}selected{% endif %}>–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É</option>
        </select>

        <button type="submit" class="btn btn-primary">üîç –ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        <a href="{% url 'home' %}" class="btn btn-outline">‚ùå –°–±—Ä–æ—Å–∏—Ç—å</a>
    </form>
</div>

<!-- –°–µ—Ç–∫–∞ –±–ª—é–¥ -->
<div class="dishes-grid">
    {% for dish in dishes %}
    <div class="dish-card" onclick="window.location.href='{% url 'dish_detail' dish.slug %}'" style="cursor: pointer;">
        {% if dish.–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ %}
        <img src="{{ dish.–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ }}" alt="{{ dish.–Ω–∞–∑–≤–∞–Ω–∏–µ }}" class="dish-image">
        {% else %}
        <div class="dish-image" style="background: #ddd; display: flex; align-items: center; justify-content: center; color: #999;">
            üçΩÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
        </div>
        {% endif %}

        <div class="dish-info">
            <h3 class="dish-name">{{ dish.–Ω–∞–∑–≤–∞–Ω–∏–µ }}</h3>
            <p class="dish-description">{{ dish.–æ–ø–∏—Å–∞–Ω–∏–µ }}</p>

            <div class="dish-price">
                {% if dish.–∞–∫—Ü–∏—è %}
                    <span class="current-price">{{ dish.—Ç–µ–∫—É—â–∞—è_—Ü–µ–Ω–∞ }} ‚ÇΩ</span>
                    <span class="original-price">{{ dish.—Ü–µ–Ω–∞ }} ‚ÇΩ</span>
                    <span class="discount-badge">-{{ dish.–ø—Ä–æ—Ü–µ–Ω—Ç_—Å–∫–∏–¥–∫–∏ }}%</span>
                {% else %}
                    <span class="current-price">{{ dish.—Ü–µ–Ω–∞ }} ‚ÇΩ</span>
                {% endif %}
            </div>

            <!-- –†–µ–π—Ç–∏–Ω–≥ -->
            <div class="rating">
                {% with rating=dish.—Å—Ä–µ–¥–Ω–∏–π_—Ä–µ–π—Ç–∏–Ω–≥ %}
                {% for i in "12345" %}
                    {% if forloop.counter <= rating %}
                        ‚òÖ
                    {% else %}
                        ‚òÜ
                    {% endif %}
                {% endfor %}
                <span class="rating-count">({{ dish.–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–æ—Ç–∑—ã–≤–æ–≤ }})</span>
                {% endwith %}
            </div>

            <div class="dish-actions">
                {% if user.is_authenticated %}
                    <button onclick="event.stopPropagation(); addToCart({{ dish.id }})" class="btn btn-primary">
                        üõí –í –∫–æ—Ä–∑–∏–Ω—É
                    </button>
                    <a href="{% url '–¥–æ–±–∞–≤–∏—Ç—å_–≤_–∏–∑–±—Ä–∞–Ω–Ω–æ–µ' dish.id %}" class="btn btn-outline" onclick="event.stopPropagation()">
                        ‚ù§Ô∏è
                    </a>
                {% else %}
                    <a href="{% url 'login' %}" class="btn btn-primary" onclick="event.stopPropagation()">
                        üîë –í–æ–π—Ç–∏
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
    {% empty %}
    <div style="text-align: center; grid-column: 1 / -1; color: #636e72; padding: 3rem;">
        <h3>üòî –ë–ª—é–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã</p>
    </div>
    {% endfor %}
</div>

<script>
// –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∫–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–∞–º –æ—Ç –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏
document.addEventListener('click', function(e) {
    if (e.target.closest('.btn') || e.target.closest('button')) {
        e.stopPropagation();
    }
});
</script>
{% endblock %}